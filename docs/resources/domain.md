---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "libvirt_domain Resource - terraform-provider-libvirt"
subcategory: ""
description: |-
  Manages a libvirt domain (virtual machine).
  This resource follows the libvirt domain XML schema https://libvirt.org/formatdomain.html closely,
  providing fine-grained control over VM configuration.
---

# libvirt_domain (Resource)

Manages a libvirt domain (virtual machine).

This resource follows the [libvirt domain XML schema](https://libvirt.org/formatdomain.html) closely,
providing fine-grained control over VM configuration.

## Example Usage

```terraform
# Basic VM configuration
resource "libvirt_domain" "example" {
  name   = "example-vm"
  memory = 2048
  unit   = "MiB"
  vcpu   = 2
  type   = "kvm"

  os {
    type    = "hvm"
    arch    = "x86_64"
    machine = "q35"
    boot_devices = ["hd", "network"]
  }

  devices = {
    disks = [
      {
        source = "/var/lib/libvirt/images/example.qcow2"
        target = "vda"
        bus    = "virtio"
      }
    ]
    interfaces = [
      {
        type  = "network"
        model = "virtio"
        source = {
          network = "default"
        }
      }
    ]
  }
}

# VM with UEFI firmware
resource "libvirt_domain" "uefi_example" {
  name   = "uefi-vm"
  memory = 4096
  unit   = "MiB"
  vcpu   = 4
  type   = "kvm"

  os {
    type        = "hvm"
    arch        = "x86_64"
    machine     = "q35"
    firmware    = "efi"
    loader_path = "/usr/share/edk2/x64/OVMF_CODE.secboot.4m.fd"
    loader_readonly = true
    loader_type     = "pflash"
    nvram_path      = "/usr/share/edk2/x64/OVMF_VARS.4m.fd"
    boot_devices    = ["hd"]
  }
}

# VM with direct kernel boot
resource "libvirt_domain" "kernel_boot" {
  name   = "kernel-boot-vm"
  memory = 1024
  unit   = "MiB"
  vcpu   = 1
  type   = "kvm"

  os {
    type        = "hvm"
    arch        = "x86_64"
    kernel      = "/boot/vmlinuz"
    initrd      = "/boot/initrd.img"
    kernel_args = "console=ttyS0 root=/dev/vda1"
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `memory` (Number) Maximum memory allocation in the specified unit. Default unit is KiB.
- `name` (String) Domain name. Must be unique on the host.
- `vcpu` (Number) Number of virtual CPUs.

### Optional

- `autostart` (Boolean) Whether the domain should be started automatically when the host boots.
- `bootloader` (String) Bootloader path for paravirtualized guests (Xen).
- `bootloader_args` (String) Arguments to pass to bootloader.
- `clock` (Block, Optional) Clock configuration for the domain. (see [below for nested schema](#nestedblock--clock))
- `cpu` (Attributes) CPU configuration for the domain. (see [below for nested schema](#nestedatt--cpu))
- `create` (Attributes) Domain start flags corresponding to virDomainCreateFlags. Only used when running=true.

See [libvirt domain documentation](https://libvirt.org/html/libvirt-libvirt-domain.html#virDomainCreateFlags). (see [below for nested schema](#nestedatt--create))
- `current_memory` (Number) Actual memory allocation at boot time. If not set, defaults to memory value.
- `description` (String) Human-readable description of the domain.
- `destroy` (Block, Optional) Domain shutdown behavior. Controls how the domain is stopped when running changes from true to false or when the resource is destroyed. (see [below for nested schema](#nestedblock--destroy))
- `devices` (Attributes) Devices attached to the domain (disks, network interfaces, etc.). (see [below for nested schema](#nestedatt--devices))
- `features` (Attributes) Hypervisor features to enable. (see [below for nested schema](#nestedatt--features))
- `hwuuid` (String) Hardware UUID for the domain.
- `iothreads` (Number) Number of I/O threads for virtio disks.
- `max_memory` (Number) Maximum memory for hotplug. Must be >= memory.
- `max_memory_slots` (Number) Number of slots for memory hotplug. Required when max_memory is set.
- `on_crash` (String) Action to take when guest crashes (destroy, restart, preserve, rename-restart, coredump-destroy, coredump-restart).
- `on_poweroff` (String) Action to take when guest requests poweroff (destroy, restart, preserve, rename-restart).
- `on_reboot` (String) Action to take when guest requests reboot (destroy, restart, preserve, rename-restart).
- `os` (Attributes) Operating system configuration for the domain. (see [below for nested schema](#nestedatt--os))
- `pm` (Attributes) Power management configuration for the domain. (see [below for nested schema](#nestedatt--pm))
- `running` (Boolean) Whether the domain should be running. If true, the domain will be started after creation. If false or unset, the domain will only be defined but not started.
- `title` (String) Short description title for the domain.
- `type` (String) Domain type (e.g., 'kvm', 'qemu').
- `unit` (String) Memory unit (KiB, MiB, GiB, TiB).
- `uuid` (String) Domain UUID. If not specified, one will be generated.

### Read-Only

- `id` (String) Domain identifier (UUID)

<a id="nestedblock--clock"></a>
### Nested Schema for `clock`

Optional:

- `adjustment` (String) Clock adjustment in seconds.
- `basis` (String) Clock basis (utc, localtime).
- `offset` (String) Clock offset (utc, localtime, timezone, variable).
- `timer` (Block List) Timer devices for the guest clock. (see [below for nested schema](#nestedblock--clock--timer))
- `timezone` (String) Timezone name when offset is 'timezone'.

<a id="nestedblock--clock--timer"></a>
### Nested Schema for `clock.timer`

Required:

- `name` (String) Timer name (platform, pit, rtc, hpet, tsc, kvmclock, hypervclock, armvtimer).

Optional:

- `catchup` (Block, Optional) Timer catchup configuration. (see [below for nested schema](#nestedblock--clock--timer--catchup))
- `frequency` (Number) Timer frequency in Hz.
- `mode` (String) Timer mode (auto, native, emulate, paravirt, smpsafe).
- `present` (String) Whether timer is present (yes, no).
- `tickpolicy` (String) Tick policy (delay, catchup, merge, discard).
- `track` (String) Track source (guest, wall).

<a id="nestedblock--clock--timer--catchup"></a>
### Nested Schema for `clock.timer.catchup`

Optional:

- `limit` (Number) Limit in nanoseconds.
- `slew` (Number) Slew in nanoseconds.
- `threshold` (Number) Threshold in nanoseconds.




<a id="nestedatt--cpu"></a>
### Nested Schema for `cpu`

Optional:

- `check` (String) CPU check policy (none, partial, full).
- `deprecated_features` (String) How to handle deprecated features (allow, forbid).
- `match` (String) CPU match policy (exact, minimum, strict).
- `migratable` (String) Whether the CPU is migratable (on, off).
- `mode` (String) CPU mode (host-model, host-passthrough, custom).
- `model` (String) CPU model name.
- `vendor` (String) CPU vendor.


<a id="nestedatt--create"></a>
### Nested Schema for `create`

Optional:

- `autodestroy` (Boolean) Automatically destroy domain when connection closes (VIR_DOMAIN_START_AUTODESTROY).
- `bypass_cache` (Boolean) Avoid filesystem cache pollution (VIR_DOMAIN_START_BYPASS_CACHE).
- `force_boot` (Boolean) Boot domain, discarding any managed save state (VIR_DOMAIN_START_FORCE_BOOT).
- `paused` (Boolean) Launch domain in paused state (VIR_DOMAIN_START_PAUSED).
- `reset_nvram` (Boolean) Re-initialize NVRAM from template (VIR_DOMAIN_START_RESET_NVRAM).
- `validate` (Boolean) Validate XML document against schema (VIR_DOMAIN_START_VALIDATE).


<a id="nestedblock--destroy"></a>
### Nested Schema for `destroy`

Optional:

- `graceful` (Boolean) Attempt graceful shutdown before forcing. Defaults to true.
- `timeout` (Number) Timeout in seconds to wait for graceful shutdown before forcing. Defaults to 300.


<a id="nestedatt--devices"></a>
### Nested Schema for `devices`

Optional:

- `consoles` (Attributes List) Console devices for the domain. (see [below for nested schema](#nestedatt--devices--consoles))
- `disks` (Attributes List) Disk devices attached to the domain. (see [below for nested schema](#nestedatt--devices--disks))
- `emulator` (String) Path to the emulator binary (e.g., /usr/bin/qemu-system-x86_64). Optional, libvirt chooses default if not specified.
- `filesystems` (Attributes List) Filesystem devices for sharing host directories with the guest (virtio-9p). (see [below for nested schema](#nestedatt--devices--filesystems))
- `graphics` (Attributes) Graphics device for the domain (VNC or Spice). Only one type can be specified. (see [below for nested schema](#nestedatt--devices--graphics))
- `interfaces` (Attributes List) Network interfaces attached to the domain. (see [below for nested schema](#nestedatt--devices--interfaces))
- `rngs` (Attributes List) Random number generator devices for the domain. (see [below for nested schema](#nestedatt--devices--rngs))
- `serials` (Attributes List) Serial devices for the domain. (see [below for nested schema](#nestedatt--devices--serials))
- `video` (Attributes) Video device for the domain. (see [below for nested schema](#nestedatt--devices--video))

<a id="nestedatt--devices--consoles"></a>
### Nested Schema for `devices.consoles`

Optional:

- `source_path` (String) Source path for file or unix socket types. Optional.
- `target_port` (Number) Target port number. Optional.
- `target_type` (String) Target type (serial, virtio, xen, etc.). Optional.
- `type` (String) Console source type (pty, file, unix, tcp, etc.). Optional, defaults to pty.


<a id="nestedatt--devices--disks"></a>
### Nested Schema for `devices.disks`

Required:

- `target` (String) Target device name (e.g., vda, sda, hda).

Optional:

- `bus` (String) Bus type (virtio, scsi, ide, sata, usb).
- `device` (String) Device type (disk, cdrom, floppy, lun).
- `source` (String) Path to the disk image file. Mutually exclusive with volume_id.
- `volume_id` (String) ID (key) of a libvirt_volume to use as the disk source. Mutually exclusive with source.
- `wwn` (String) World Wide Name identifier for the disk (typically for SCSI disks). If not specified for SCSI disks, one will be generated. Format: 16 hex digits.


<a id="nestedatt--devices--filesystems"></a>
### Nested Schema for `devices.filesystems`

Required:

- `source` (String) Host directory path to share.
- `target` (String) Mount tag visible in the guest (used to mount the filesystem).

Optional:

- `accessmode` (String) Access mode (mapped, passthrough, squash). Defaults to mapped.
- `readonly` (Boolean) Whether the filesystem should be mounted read-only in the guest. Defaults to true.


<a id="nestedatt--devices--graphics"></a>
### Nested Schema for `devices.graphics`

Optional:

- `spice` (Attributes) Spice graphics configuration. Mutually exclusive with vnc. (see [below for nested schema](#nestedatt--devices--graphics--spice))
- `vnc` (Attributes) VNC graphics configuration. Mutually exclusive with spice. (see [below for nested schema](#nestedatt--devices--graphics--vnc))

<a id="nestedatt--devices--graphics--spice"></a>
### Nested Schema for `devices.graphics.spice`

Optional:

- `autoport` (String) Auto-allocate port (yes/no). Optional.
- `listen` (String) Listen address for Spice server. Optional.
- `port` (Number) TCP port for Spice server. Use -1 for auto. Optional.
- `tlsport` (Number) TLS port for Spice server. Optional.


<a id="nestedatt--devices--graphics--vnc"></a>
### Nested Schema for `devices.graphics.vnc`

Optional:

- `autoport` (String) Auto-allocate port (yes/no). Optional.
- `listen` (String) Listen address for VNC server. Optional.
- `port` (Number) TCP port for VNC server. Use -1 for auto. Optional.
- `socket` (String) UNIX socket path for VNC server. Optional.
- `websocket` (Number) WebSocket port for VNC. Optional.



<a id="nestedatt--devices--interfaces"></a>
### Nested Schema for `devices.interfaces`

Required:

- `type` (String) Interface type (network, bridge, user, direct, etc.).

Optional:

- `mac` (String) MAC address for the interface.
- `model` (String) Device model (virtio, e1000, rtl8139, etc.).
- `source` (Attributes) Interface source configuration. (see [below for nested schema](#nestedatt--devices--interfaces--source))

<a id="nestedatt--devices--interfaces--source"></a>
### Nested Schema for `devices.interfaces.source`

Optional:

- `bridge` (String) Bridge name (for type=bridge).
- `dev` (String) Device name (for type=user or type=direct).
- `network` (String) Network name (for type=network).
- `portgroup` (String) Port group name (for type=network).



<a id="nestedatt--devices--rngs"></a>
### Nested Schema for `devices.rngs`

Optional:

- `device` (String) Backend random device path (e.g., /dev/random, /dev/urandom, /dev/hwrng). Defaults to /dev/urandom.
- `model` (String) RNG device model (virtio, virtio-transitional, virtio-non-transitional). Defaults to virtio.


<a id="nestedatt--devices--serials"></a>
### Nested Schema for `devices.serials`

Optional:

- `source_path` (String) Source path for file or unix socket types. Optional.
- `target_port` (Number) Target port number. Optional.
- `target_type` (String) Target type (isa-serial, usb-serial, pci-serial, etc.). Optional.
- `type` (String) Serial source type (pty, file, unix, tcp, etc.). Optional, defaults to pty.


<a id="nestedatt--devices--video"></a>
### Nested Schema for `devices.video`

Optional:

- `type` (String) Video device model type (e.g., cirrus, vga, qxl, virtio, vbox, vmvga, gop). Optional.



<a id="nestedatt--features"></a>
### Nested Schema for `features`

Optional:

- `acpi` (Boolean) ACPI support.
- `apic` (Boolean) APIC support.
- `ccf_assist` (String) CCF Assist (on, off).
- `gic_version` (String) GIC version for ARM guests.
- `hap` (String) Hardware Assisted Paging (on, off).
- `htm` (String) Hardware Transactional Memory (on, off).
- `ioapic_driver` (String) IOAPIC driver (kvm, qemu).
- `nested_hv` (String) Nested HV (on, off).
- `pae` (Boolean) Physical Address Extension mode.
- `pmu` (String) Performance Monitoring Unit (on, off).
- `privnet` (Boolean) Private network namespace.
- `ps2` (String) PS/2 controller (on, off).
- `pvspinlock` (String) Paravirtualized spinlock prevention (on, off).
- `ras` (String) Reliability, Availability and Serviceability (on, off).
- `viridian` (Boolean) Viridian enlightenments for Windows guests.
- `vmcoreinfo` (String) VM crash information (on, off).
- `vmport` (String) VMware IO port emulation (on, off, auto).


<a id="nestedatt--os"></a>
### Nested Schema for `os`

Required:

- `type` (String) OS type (e.g., 'hvm' for fully virtualized, 'linux' for paravirtualized).

Optional:

- `arch` (String) CPU architecture (e.g., 'x86_64', 'aarch64').
- `boot_devices` (List of String) Ordered list of boot devices (e.g., 'hd', 'network', 'cdrom'). If not specified, libvirt may add default boot devices.
- `firmware` (String) Firmware type (e.g., 'efi', 'bios').
- `initrd` (String) Path to initrd image for direct kernel boot.
- `kernel` (String) Path to kernel image for direct kernel boot.
- `kernel_args` (String) Kernel command line arguments.
- `loader_path` (String) Path to UEFI firmware loader.
- `loader_readonly` (Boolean) Whether the UEFI firmware is read-only.
- `loader_type` (String) Loader type ('rom' or 'pflash').
- `machine` (String) Machine type (e.g., 'pc', 'q35'). Note: This value represents what you want, but libvirt may internally expand it to a versioned type.
- `nvram_path` (String) Path to NVRAM template for UEFI.


<a id="nestedatt--pm"></a>
### Nested Schema for `pm`

Optional:

- `suspend_to_disk` (String) Suspend to disk policy (yes, no).
- `suspend_to_mem` (String) Suspend to memory policy (yes, no).
